# Go Transactions API

A production-ready REST API built with **Go**, following the **Repository Pattern** with clean separation of concerns across handler → service → repository layers.

<img width="1898" height="914" alt="image" src="https://github.com/user-attachments/assets/68ad7736-9b8f-4176-9a6d-1b11fe295216" />


## Tech Stack

| Concern | Library |
|---|---|
| Router | [chi v5](https://github.com/go-chi/chi) |
| Database | PostgreSQL via [pgx v5](https://github.com/jackc/pgx) |
| Query generation | [sqlc](https://sqlc.dev) |
| Migrations | [Goose](https://github.com/pressly/goose) |
| Auth | [golang-jwt/jwt v5](https://github.com/golang-jwt/jwt) · HS256 · 7-day expiry |
| Password hashing | bcrypt |
| ID generation | [cuid](https://github.com/lucsky/cuid) |
| API docs | [Scalar](https://scalar.com) (OpenAPI 3.0) |
| Hot reload | [Air](https://github.com/air-verse/air) |

## Project Structure

```
.
├── cmd/
│   ├── main.go          # Entry point — config, DB connection, server start
│   └── api.go           # Router, middleware, route wiring
├── internal/
│   ├── adapters/
│   │   └── postgresql/
│   │       ├── migrations/   # Goose SQL migrations
│   │       └── sqlc/         # sqlc-generated code (DO NOT edit manually)
│   ├── auth/
│   │   ├── types.go      # Domain model, DTOs, Repository & Service interfaces
│   │   ├── repository.go # Postgres adapter (only file that touches sqlc/pgtype)
│   │   ├── service.go    # Business logic — register, login, JWT issuance
│   │   ├── handler.go    # HTTP handlers
│   │   ├── middleware.go # Bearer token validation, injects userID into context
│   │   ├── jwt.go        # JWT sign / verify helpers
│   │   └── errors.go     # Sentinel errors (ErrEmailTaken, …)
│   ├── users/
│   │   ├── types.go      # Domain model, DTOs, Repository & Service interfaces
│   │   ├── repository.go # Postgres adapter
│   │   ├── service.go    # Business logic — get current user
│   │   └── handler.go    # HTTP handlers
│   ├── env/              # Env var helpers
│   ├── json/             # JSON read/write helpers
│   └── utils/
├── docs/
│   └── swagger.json      # OpenAPI 3.0 spec
├── .air.toml             # Air hot-reload config
├── sqlc.yaml             # sqlc config
└── .env                  # Local environment variables
```

## Getting Started

### Prerequisites

- Go 1.21+
- PostgreSQL
- [Goose](https://github.com/pressly/goose) — `go install github.com/pressly/goose/v3/cmd/goose@latest`
- [sqlc](https://sqlc.dev) — `go install github.com/sqlc-dev/sqlc/cmd/sqlc@latest`
- [Air](https://github.com/air-verse/air) — `go install github.com/air-verse/air@latest`

### Setup

**1. Clone and install dependencies**
```bash
git clone https://github.com/Ajay01103/Go-SQLC-Transactions-API
cd Go-SQLC-Transactions-API
go mod download
```

**2. Configure environment**

Create a `.env` file in the project root:
```env
GOOSE_DBSTRING="host=localhost user=postgres password=<your_password> dbname=godb sslmode=disable"
GOOSE_DRIVER=postgres
GOOSE_MIGRATION_DIR=./internal/adapters/postgresql/migrations
JWT_SECRET=<your_secret>
```

**3. Run migrations**
```bash
goose up
```

**4. Start the server**

Development (hot reload):
```bash
air
```

Or without Air:
```bash
cd cmd && go run .
```

Server starts on **`:8000`**.

## API Reference

Interactive docs available at **[http://localhost:8000/reference](http://localhost:8000/reference)** (Scalar UI).

### Endpoints

| Method | Path | Auth | Description |
|---|---|---|---|
| `GET` | `/health` | — | Liveness check |
| `POST` | `/auth/register` | — | Register a new user, returns JWT |
| `POST` | `/auth/login` | — | Login, returns JWT |
| `GET` | `/users/current-user` | Bearer JWT | Get authenticated user's profile |

### Auth Flow

1. `POST /auth/register` or `POST /auth/login` → returns `{ "access_token": "...", "user": { ... } }`
2. Pass the token in subsequent requests: `Authorization: Bearer <access_token>`
3. Token is valid for **7 days**

### Example — Register

```bash
curl -X POST http://localhost:8000/auth/register \
  -H "Content-Type: application/json" \
  -d '{"name": "Jane Doe", "email": "jane@example.com", "password": "secret123"}'
```

```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": "cma3k8f200000abc1xyz23def",
    "name": "Jane Doe",
    "email": "jane@example.com",
    "created_at": "2026-02-24 10:00:00 +0000 UTC"
  }
}
```

### Example — Get Current User

```bash
curl http://localhost:8000/users/current-user \
  -H "Authorization: Bearer <access_token>"
```

## Database

### Run a migration

```bash
goose up          # apply all pending migrations
goose down        # roll back last migration
goose status      # show migration state
```

### Regenerate sqlc code

After editing `queries.sql`:
```bash
sqlc generate
```

> **Never manually edit files inside `internal/adapters/postgresql/sqlc/`** — they are fully generated by sqlc.

## Architecture

The codebase follows a strict layered architecture:

```
Handler  →  Service  →  Repository interface  →  Postgres adapter (sqlc)
```

- **Handler** — HTTP only. No business logic, no DB types.
- **Service** — Business rules only. Speaks in domain types, knows nothing about sqlc or pgtype.
- **Repository interface** — Defined in domain terms. Decouples service from storage.
- **Postgres adapter** — The only place sqlc and pgtype are imported. Maps DB rows to domain models.
